openapi: 3.0.0
info:
  title: URL Shortener API
  version: 1.0.0
  description: API for managing short URLs with authentication and admin features. Built with Fiber in Go.
servers:
  - url: http://localhost:8080
    description: Local development server
paths:
  /api/v1/auth/register:
    post:
      summary: Register a new user
      description: Create a new user account with username, email, and password.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: User already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/auth/login:
    post:
      summary: Login user
      description: Authenticate user and return auth token.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
 
  /api/v1/urls:
    post:
      summary: Create a short URL
      description: Shorten a long URL for the authenticated user.
      tags:
        - User URLs
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateURLRequest'
      responses:
        '201':
          description: Short URL created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateURLResponse'
        '400':
          description: Invalid URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/urls/me:
    get:
      summary: List user's short URLs
      description: Retrieve a list of the authenticated user's short URLs with pagination.
      tags:
        - User URLs
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
          description: Page number
        - name: limit
          in: query
          schema:
            type: integer
          description: Items per page
      responses:
        '200':
          description: List of URLs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/URLItem'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/urls/{shortCode}:
    get:
      summary: Get details of a short URL
      description: Retrieve details of a specific short URL owned by the user.
      tags:
        - User URLs
      security:
        - bearerAuth: []
      parameters:
        - name: shortCode
          in: path
          required: true
          schema:
            type: string
          description: Short code of the URL
      responses:
        '200':
          description: URL details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/URLDetail'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      summary: Update a short URL
      description: Update the long URL for a specific short code owned by the user.
      tags:
        - User URLs
      security:
        - bearerAuth: []
      parameters:
        - name: shortCode
          in: path
          required: true
          schema:
            type: string
          description: Short code of the URL
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateURLRequest'
      responses:
        '200':
          description: URL updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/URLDetail'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete a short URL
      description: Delete a specific short URL owned by the user.
      tags:
        - User URLs
      security:
        - bearerAuth: []
      parameters:
        - name: shortCode
          in: path
          required: true
          schema:
            type: string
          description: Short code of the URL
      responses:
        '204':
          description: URL deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/urls/{shortCode}/stats:
    get:
      summary: Get stats for a short URL
      description: Retrieve visit statistics for a specific short URL.
      tags:
        - User URLs
      security:
        - bearerAuth: []
      parameters:
        - name: shortCode
          in: path
          required: true
          schema:
            type: string
          description: Short code of the URL
      responses:
        '200':
          description: URL stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/URLStats'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/admin/users:
    get:
      summary: List all users
      description: Retrieve a list of all users (admin only).
      tags:
        - Admin Management
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
          description: Page number
        - name: limit
          in: query
          schema:
            type: integer
          description: Items per page
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserItem'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden (not admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/admin/users/{id}:
    get:
      summary: Get user details
      description: Retrieve details of a specific user (admin only).
      tags:
        - Admin Management
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: User ID
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDetail'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      summary: Update user
      description: Update user details like role or status (admin only).
      tags:
        - Admin Management
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: User ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDetail'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete user
      description: Delete a user and associated links (admin only).
      tags:
        - Admin Management
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: User ID
      responses:
        '204':
          description: User deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/admin/urls:
    get:
      summary: List all short URLs
      description: Retrieve a system-wide list of short URLs (admin only).
      tags:
        - Admin Management
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
          description: Page number
        - name: limit
          in: query
          schema:
            type: integer
          description: Items per page
      responses:
        '200':
          description: List of URLs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/URLItem'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/admin/urls/{id}:
    get:
      summary: Get details of any short URL
      description: Retrieve details of a specific short URL (admin only).
      tags:
        - Admin Management
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: URL ID
      responses:
        '200':
          description: URL details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/URLDetail'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete any short URL
      description: Delete a specific short URL (admin only).
      tags:
        - Admin Management
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: URL ID
      responses:
        '204':
          description: URL deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /{shortCode}:
    get:
      summary: Redirect to original URL
      description: Redirect to the long URL using the short code. Increments visit count.
      tags:
        - Redirect
      parameters:
        - name: shortCode
          in: path
          required: true
          schema:
            type: string
          description: Short code
      responses:
        '301':
          description: Permanent redirect to long URL
        '302':
          description: Temporary redirect to long URL
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  schemas:
    RegisterRequest:
      type: object
      properties:
        username:
          type: string
        email:
          type: string
        password:
          type: string
      required:
        - username
        - email
        - password
    RegisterResponse:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
    LoginRequest:
      type: object
      properties:
        email:
          type: string
        password:
          type: string
      required:
        - email
        - password
    LoginResponse:
      type: object
      properties:
        token:
          type: string
    SuccessResponse:
      type: object
      properties:
        message:
          type: string
    CreateURLRequest:
      type: object
      properties:
        long_url:
          type: string
      required:
        - long_url
    CreateURLResponse:
      type: object
      properties:
        short_code:
          type: string
        short_url:
          type: string
    UpdateURLRequest:
      type: object
      properties:
        long_url:
          type: string
      required:
        - long_url
    URLItem:
      type: object
      properties:
        short_code:
          type: string
        long_url:
          type: string
        created_at:
          type: string
          format: date-time
        visits:
          type: integer
    URLDetail:
      type: object
      properties:
        short_code:
          type: string
        long_url:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        owner_id:
          type: integer
        visits:
          type: integer
    URLStats:
      type: object
      properties:
        visits:
          type: integer
        last_visit:
          type: string
          format: date-time
        visit_history:
          type: array
          items:
            type: object
            properties:
              timestamp:
                type: string
                format: date-time
              ip:
                type: string
    UserItem:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        email:
          type: string
        role:
          type: string
    UserDetail:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        email:
          type: string
        role:
          type: string
        created_at:
          type: string
          format: date-time
        urls:
          type: array
          items:
            $ref: '#/components/schemas/URLItem'
    UpdateUserRequest:
      type: object
      properties:
        role:
          type: string
        status:
          type: string
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: PASETO
